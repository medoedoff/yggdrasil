# Maintainer: Your Name <almahan@group-ib.com>
pkgname=cargo-mirror
pkgver=0.0.1
pkgrel=1
pkgdesc="Cargo cache mirror server"
arch=('x86_64')
depends=('python-virtualenv' 'python')
makedepends=('make' 'gcc' 'python-pip' 'python' 'python-wheel' 'python-virtualenv')
provides=()
install=install

pkgver() {
     printf "${CI_COMMIT_TAG}\n"
}

build() {
	local requirements="../../../requirements.txt"
    pip wheel -w . -r $requirements
}

package() {
	local source=../../..
	local maindir="$pkgdir/opt/tds/cargo-mirror"
	local logdir="$pkgdir/var/log/cargo-mirror"
	mkdir -p $maindir/{dependencies,venv} $logdir
	cp -r *.whl $maindir/dependencies/
	find $source -mindepth 1 -maxdepth 1 -not -path "$source/build" -not -path "$source/.git" \
	    -not -path "$source/.gitlab-ci.yml" -not -path "$source/.gitignore" -type d -exec cp -r {} $maindir/ \;
	cp $source/*.py $maindir
}
